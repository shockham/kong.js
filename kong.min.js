var Entity=function(a,b,c,f,e,d){this.x=a;this.y=b;this.Width=f;this.Height=e;this.Speed=256;this.Type="";this.Alive=!0;this.Img=new Image;this.Img.onload=function(){this.Ready=!0};this.Img.src=c;this.Rotation=0;this.layer=d||0};Entity.prototype.update=function(){};Entity.prototype.draw=function(a){a.save();a.translate(this.x+this.Width/2,this.y+this.Height/2);a.rotate(this.Rotation);this.Img.Ready&&a.drawImage(this.Img,-(this.Width/2),-(this.Height/2),this.Width,this.Height);a.restore()};
var Textity=function(a,b,c,f,e,d){this.x=a;this.y=b;this.Text=c;this.Colour=f;this.Size=e;this.Alive=!0;this.layer=d||0};Textity.prototype.update=function(){};Textity.prototype.draw=function(a){a.font=this.Size+"px 'VT323'";a.textAlign="center";a.fillStyle=this.Colour;a.fillText(this.Text,this.x,this.y)};var Rectity=function(a,b,c,f,e,d){this.x=a;this.y=b;this.Width=f;this.Height=e;this.Colour=c;this.Alive=!0;this.layer=d||0};Rectity.prototype.update=function(){};
Rectity.prototype.draw=function(a){a.fillStyle=this.Colour;a.fillRect(this.x,this.y,this.Width,this.Height)};var Linity=function(a,b,c,f,e,d){this.x=a;this.y=b;this.EndX=c;this.EndY=f;this.Width=e;this.Colour="#000000";this.Alive=!0;this.layer=d||0};Linity.prototype.update=function(){};Linity.prototype.draw=function(a){a.save();a.fillStyle=this.Colour;a.beginPath();a.moveTo(this.x,this.y);a.lineTo(this.EndX,this.EndY);a.lineWidth=this.Width;a.stroke();a.restore()};
var State=function(){this.Objects=[]};State.prototype.add=function(a){this.Objects[this.Objects.length]=a};State.prototype.remove=function(a){a=this.Objects.indexOf(a);-1!=a&&this.Objects.splice(a,1)};State.prototype.update=function(a){for(var b in this.Objects)this.Objects[b].Alive&&this.Objects[b].update(a)};
State.prototype.draw=function(){for(var a=[],b=0;2>=b;b++)a.push(document.getElementById("game_canvas_"+b).getContext("2d")),a[b].clearRect(0,0,a[b].canvas.width,a[b].canvas.height);for(var c in this.Objects)this.Objects[c].Alive&&this.Objects[c].draw(a[this.Objects[c].layer])};var Game=function(a,b,c,f){this.width=a;this.height=b;for(var e=0;2>=e;e++)this.add_canvas(e,a,b,c,f);this.State=new State};
Game.prototype.add_canvas=function(a,b,c,f,e){var d=document.createElement("canvas");d.id="game_canvas_"+a;d.width=b;d.height=c;d.style.width=f+"px";d.style.height=e+"px";d.style.position="absolute";d.style.backgroundColor="transparent";a=d.getContext("2d");a.font="40px Monofett";a.textBaseline="top";document.body.appendChild(d)};var has_focus=!0;window.onfocus=function(){has_focus=!0};window.onblur=function(){has_focus=!1};Game.prototype.update=function(a){has_focus&&this.State.update(a)};
Game.prototype.draw=function(){this.State.draw()};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var _g_;Game.prototype.main=function(a){var b=Date.now(),c=b-then;this.draw();this.update(c/1E3);then=b;a&&(_g_=a);window.requestAnimFrame(function(){_g_.main()})};var then=Date.now();
Game.prototype.start=function(){then=Date.now();this.main(this)};Game.prototype.touching=function(a,b){return a.x<=b.x+b.Width&&b.x<=a.x+a.Width&&a.y<=b.y+b.Height&&b.y<=a.y+a.Height?!0:!1};Game.prototype.collide=function(a,b){if(a.x<=b.x+b.Width&&b.x<=a.x+a.Width&&a.y<=b.y+b.Height&&b.y<=a.y+a.Height){var c=b.x+b.Width-a.x,f=a.x+a.Width-b.x,e=b.y+b.Height-a.y,d=a.y+a.Height-b.y;(c||f)>(e||d)?a.x=c<f?b.x+b.Width:b.x-b.Width:a.y=e<d?b.y+b.Height:b.y-b.Height}};
var Music=function(a){this.music=document.createElement("audio");this.music.src=a};Music.prototype.play=function(){this.music.play()};Music.prototype.loop=function(){this.music.loop=!0;this.music.play()};Music.prototype.stop=function(){this.music.pause()};var keysDown={};addEventListener("keydown",function(a){keysDown[a.keyCode]=!0},!1);addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1);var touches=[];
addEventListener("touchstart",function(a){a.preventDefault();touches=a.touches},!1);addEventListener("touchend",function(a){a.preventDefault();touches=a.touches},!1);addEventListener("mousedown",function(a){touches[0]=a},!1);addEventListener("mouseup",function(){touches[0]=null},!1);
